@model IEnumerable<SexShop.Application.DTOs.OrderDto>
@{
    ViewData["Title"] = "Mis Pedidos";
}

<div class="row pt-4 mb-4">
    <div class="col-12 text-center">
        <h1 class="fw-bold">Mis <span class="text-accent">Pedidos</span></h1>
        <p class="text-secondary">Historial de tus compras realizadas con absoluta discreción.</p>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show bg-dark text-success border-success mb-4" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model.Any())
{
    <div class="row justify-content-center">
        <div class="col-lg-10">
            @foreach (var order in Model.OrderByDescending(o => o.OrderDate))
            {
                <div class="card mb-4 shadow-lg border-0 bg-secondary-bg">
                    <div class="card-header bg-dark border-bottom border-secondary d-flex justify-content-between align-items-center py-3">
                        <div>
                            <span class="text-secondary small text-uppercase">Pedido #@order.Id</span>
                            <h5 class="mb-0 fw-bold">Fecha: @order.OrderDate.ToString("dd/MM/yyyy HH:mm")</h5>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-primary rounded-pill px-3">@order.Status</span>
                            <div class="fs-4 fw-bold text-accent mt-1">$@order.TotalAmount.ToString("N0")</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold mb-3 text-secondary">Detalles del pedido:</h6>
                        <div class="table-responsive">
                            <table class="table table-dark table-hover mb-0">
                                <thead>
                                    <tr class="text-secondary small">
                                        <th>Producto</th>
                                        <th class="text-center">Cantidad</th>
                                        <th class="text-end">Precio Unit.</th>
                                        <th class="text-end">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in order.Details)
                                    {
                                        <tr>
                                            <td>@item.ProductName</td>
                                            <td class="text-center">@item.Quantity</td>
                                            <td class="text-end">$@item.UnitPrice.ToString("N0")</td>
                                            <td class="text-end fw-bold text-white">$@((item.Quantity * item.UnitPrice).ToString("N0"))</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}
else
{
    <div class="text-center py-5">
        <i class="bi bi-bag-x display-1 text-secondary opacity-25"></i>
        <h2 class="mt-4">Aún no tienes pedidos</h2>
        <p class="text-secondary mb-4">Cuando realices tu primera compra, aparecerá aquí.</p>
        <a asp-controller="Home" asp-action="Index" class="btn btn-primary btn-lg px-5 rounded-pill">EMPEZAR A COMPRAR</a>
    </div>
}
